{% load static %}
<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Manage</title>

    <link rel="stylesheet" href="{% static 'style/my.css' %}">

    <link rel="stylesheet" href="{% static 'style/others.css' %}">
    <link rel="stylesheet" href="{% static 'style/mdui.min.css' %}">
    <link rel="stylesheet" href="{% static 'style/index.css' %}">
    <link rel="stylesheet" href="{% static 'style/bulma.min.css' %}">

    <script defer src="{% static 'javascript/all.js' %}"></script>
    <script src="{% static 'javascript/vue.js' %}"></script>
    <script src="{% static 'javascript/index.js' %}"></script>
    <script src="{% static 'javascript/jquery.min.js' %}"></script>
    <script src="{% static 'javascript/mdui.min.js' %}"></script>
</head>

<body>
<div id="index">
    <nav class="navbar is-transparent">
        <div class="navbar-brand">
            <a class="navbar-item" @click="isCollapse=!isCollapse">
                <img src="{% static 'image/safari.png' %}" alt="contact_system" width="30" height="40">
            </a>
        </div>
        <div id="navbarExampleTransparentExample" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <p>欢迎回来，{{ username }}</p>
                </div>
                <div class="navbar-item">
                    <el-button type="text" @click="logout">
                                    <span>
                                        注销
                                    </span>
                    </el-button>
                </div>
            </div>
        </div>
    </nav>


    <el-container v-bind:style="{border: '1px solid #eee', height:myheight}">
        <el-menu default-active="1-4-1" class="el-menu-vertical-demo" @open="handleOpen" @close="handleClose"
                 :collapse="isCollapse">
            <el-submenu index="1">
                <template slot="title">
                    <i class="mdui-icon material-icons">&#xe85d;</i>
                    <span slot="title">合同管理</span>
                </template>
                <el-menu-item index="1-1" data-target="#assignment1" @click="setiframeScr('myContract')">
                    <i class="el-icon-edit"></i>
                    我起草的合同
                </el-menu-item>
                <el-menu-item index="1-2" data-target="#assignment1" @click="setiframeScr('myManageContract')">
                    <i class="el-icon-view"></i>
                    我管理的合同
                </el-menu-item>
                <el-menu-item index="1-3" data-target="#assignment" @click="setiframeScr('setContract')">
                    <i class="el-icon-share"></i>
                    分配合同
                </el-menu-item>
                <el-menu-item index="1-4" data-target="#assignment1" @click="setiframeScr('allContract')">
                    <i class="el-icon-tickets"></i>
                    全部合同
                </el-menu-item>
            </el-submenu>
            <el-menu-item index="2" @click="setiframeScr('role')">
                <i class="mdui-icon material-icons">&#xe85e;</i>
                <span slot="title">角色管理</span>
            </el-menu-item>
            <el-menu-item index="3" @click="setiframeScr('user')">
                <i class="mdui-icon material-icons">&#xe853;</i>
                <span slot="title">用户管理</span>
            </el-menu-item>
            <el-submenu index="4">
                <template slot="title">
                    <i class="mdui-icon material-icons">&#xe87c;</i>
                    <span slot="title">客户管理</span>
                </template>
                <el-menu-item index="4-1" data-target="#assignment" @click="setiframeScr('myClient')">
                    <i class="el-icon-service"></i>
                    我的客户
                </el-menu-item>
                <el-menu-item index="4-2" data-target="#assignment1" @click="setiframeScr('allClient')">
                    <i class="el-icon-news"></i>
                    全部客户
                </el-menu-item>
            </el-submenu>
            <el-menu-item index="5" @click="setiframeScr('log')">
                <i class="mdui-icon material-icons">&#xe86d;</i>
                <span slot="title">日志</span>
            </el-menu-item>
        </el-menu>


        <el-container>
            <iframe v-if="iframeScr!=''" :src="iframeScr" height="100%" width="100%"></iframe>
            <iframe v-else :src="'myContract'" height="100%" width="100%"></iframe>
        </el-container>
    </el-container>
</div>
</body>


<script>
    var index = new Vue({
        el: '#index',
        created: function () {
            this.setmyheight();
            $.ajax({
                url: "/manage",
                type: "POST",
                success: function (data1) {
                    index.role.fun1 = data1.fun1;
                    index.role.fun2 = data1.fun2;
                    index.role.fun3 = data1.fun3;
                    index.role.fun4 = data1.fun4;
                    index.role.fun5 = data1.fun5;
                    index.role.fun6 = data1.fun6;
                }
            })
        },
        data() {
            return {
                isCollapse: true,
                iframeScr: '',
                myheight: '',
                role: {
                    fun1: false,
                    fun2: false,
                    fun3: false,
                    fun4: false,
                    fun5: false,
                    fun6: false,
                }
            };
        },
        methods: {
            handleOpen(key, keyPath) {
                console.log(key, keyPath);
            },
            handleClose(key, keyPath) {
                console.log(key, keyPath);
            },
            setiframeScr(scr) {
                let role_ = index.role;
                let ok = true;
                if (scr === 'allContract' && !role_.fun1) ok = false;
                if (scr === 'myManageContract' && !role_.fun2) ok = false;
                if (scr === 'setContract' && !role_.fun3) ok = false;
                if (scr === 'user' && !role_.fun4) ok = false;
                if (scr === 'role' && !role_.fun5) ok = false;
                if (scr === 'allClient' && !role_.fun6) ok = false;

                if (!ok) {
                    index.$message.error("对不起，您没有权限访问！");
                } else {
                    this.iframeScr = scr;
                }
            },
            setmyheight() {
                this.myheight = window.innerHeight - 60 + 'px';
            },
            logout() {
                window.location.href = "/logout";
            }
        }
    })

</script>


</html>